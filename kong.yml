_format_version: "3.0"
_transform: true

services:
  - name: user-service
    url: http://dongyi-user-serv.zeabur.internal:8080
    routes:
      - name: users-route
        paths: ["/users"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false
      - name: drivers-route
        paths: ["/drivers"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false
      - name: images-route
        paths: ["/images"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false
      - name: auth-route
        paths: ["/auth"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false
      - name: notifications-route
        paths: ["/notifications"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false

  - name: cart-service
    url: http://dongyi-cart-serv.zeabur.internal:8080
    routes:
      - name: cart-route
        paths: ["/cart"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false

  - name: product-service
    url: https://dongyi-product.hnd1.zeabur.app
    routes:
      - name: product-route
        paths: ["/product"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false

  - name: order-service
    url: http://dongyi-order-serv.zeabur.internal:8080
    routes:
      - name: order-route
        paths: ["/order"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false

  - name: ads-service
    url: http://dongyi-ads-serv.zeabur.internal:8080
    routes:
      - name: ads-route
        paths: ["/ads"]
        methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
        strip_path: false

plugins:
  # User service plugins
  - name: cors
    service: user-service
    config:
      origins: ["*"]
      methods: ["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
      headers: ["Accept","Authorization","Content-Type"]
      exposed_headers: ["Authorization"]
      credentials: true
      max_age: 3600

  - name: rate-limiting
    service: user-service
    config:
      minute: 10000
      limit_by: ip
      policy: local
      fault_tolerant: true
      hide_client_headers: false

  # Cart service plugins
  - name: cors
    service: cart-service
    config:
      origins: ["*"]
      methods: ["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
      headers: ["Accept","Authorization","Content-Type"]
      exposed_headers: ["Authorization"]
      credentials: true
      max_age: 3600

  - name: rate-limiting
    service: cart-service
    config:
      minute: 10000
      limit_by: ip
      policy: local
      fault_tolerant: true
      hide_client_headers: false

  # Product service plugins
  - name: cors
    service: product-service
    config:
      origins: ["*"]
      methods: ["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
      headers: ["Accept","Authorization","Content-Type"]
      exposed_headers: ["Authorization"]
      credentials: true
      max_age: 3600

  - name: rate-limiting
    service: product-service
    config:
      minute: 10000
      limit_by: ip
      policy: local
      fault_tolerant: true
      hide_client_headers: false

  # Order service plugins
  - name: cors
    service: order-service
    config:
      origins: ["*"]
      methods: ["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
      headers: ["Accept","Authorization","Content-Type"]
      exposed_headers: ["Authorization"]
      credentials: true
      max_age: 3600

  - name: rate-limiting
    service: order-service
    config:
      minute: 10000
      limit_by: ip
      policy: local
      fault_tolerant: true
      hide_client_headers: false

  # Ads service plugins
  - name: cors
    service: ads-service
    config:
      origins: ["*"]
      methods: ["GET","POST","PUT","PATCH","DELETE","OPTIONS"]
      headers: ["Accept","Authorization","Content-Type"]
      exposed_headers: ["Authorization"]
      credentials: true
      max_age: 3600

  - name: rate-limiting
    service: ads-service
    config:
      minute: 10000
      limit_by: ip
      policy: local
      fault_tolerant: true
      hide_client_headers: false
